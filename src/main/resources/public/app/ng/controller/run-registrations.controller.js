angular.module("run_proud").controller("RunRegistrationController",["$rootScope","$scope","$state","$cookies","$http","$filter","Access","RunEventDataOp","RegistrationDataOp",function(e,n,i,o,t,r,s,a,c){n.user=null,n.isAdmin=function(){return!!n.user&&"ADMIN"==n.user.role},n.approve=function(e){$("#loading").modal("show"),a.approveRegistration(e).then(function(e){console.log(e),n.getRunRegistrations(),$("#loading").modal("hide")}).catch(function(e){console.log(e),$("#loading").modal("hide")})},n.getRunRegistrations=function(){a.getRunParticipants().then(function(e){n.registrations.init(e.data)}).catch(function(e){console.log(e)})},n.registrations={data:[],currentPageList:[],filteredList:[],totalItems:0,numPages:void 0,maxSize:5,currentPage:1,boundary_links:!0,numPerPage:10,numPerPageSelections:[5,10,20,50,100],pageChange:function(){var e=(this.currentPage-1)*this.numPerPage,t=e+this.numPerPage;this.currentPageList=this.filteredList.slice(e,t)},searchKeyword:"",search:function(){this.filteredList=r("filter")(this.data,this.searchKeyword),this.totalItems=this.filteredList.length;var e=(this.currentPage-1)*this.numPerPage,t=e+this.numPerPage;this.currentPageList=this.filteredList.slice(e,t)},numPageChange:function(){var e=(this.currentPage-1)*this.numPerPage,t=e+this.numPerPage;this.currentPageList=this.filteredList.slice(e,t)},init:function(e){this.data=e,this.totalItems=e.length,this.filteredList=e;var t=(this.currentPage-1)*this.numPerPage,n=t+this.numPerPage;this.currentPageList=this.filteredList.slice(t,n)}},n.reg_to_delete=null,n.reg_to_change=null,n.battles=[],n.showConfirmDelete=function(e){n.reg_to_delete=e,$("#confirm-delete").modal("show")},n.showCategoryChange=function(e){n.reg_to_change=e,$("#edit-category").modal("show")},n.changeCategory=function(){a.changeRunCategory(n.reg_to_change).then(function(e){$("#edit-category").modal("hide")}).catch(function(e){console.log(e)})},n.deleteReg=function(){c.deleteReg(n.reg_to_delete).then(function(e){console.log(e),n.getRunRegistrations(),$("#confirm-delete").modal("hide")}).catch(function(e){console.log(e)})},n.getCategories=function(){a.getRunCategories().then(function(e){n.battles=e.data}).catch(function(e){console.log(e)})},n.start=function(){n.$emit("childEmit",n.user),n.getRunRegistrations(),n.getCategories()},n.checkUser=function(e){if(s.user)n.user=s.user,n.start();else{var t=o.get("run_proud_token");t?s.getClaimsFromToken(t,function(e){n.user=e.data.principal.user,n.start()},function(e){console.log(e),s.clearData(),o.remove("run_proud_token"),i.go("login")}):i.go("login")}},n.checkUser(n.start)}]);