angular.module("run_proud").controller("RecordController",["$rootScope","$scope","$state","$cookies","$timeout","$filter","Access","RunEventDataOp",function(t,e,i,s,r,n,a,o){e.user={},e.submit={},e.isAdmin=function(){return"ADMIN"==e.user.role},e.selectedRecord={},e.records={data:[],currentPageList:[],filteredList:[],totalItems:0,numPages:5,maxSize:5,currentPage:1,boundary_links:!0,numPerPage:10,numPerPageSelections:[5,10,20,50,100],pageChange:function(){var t=(this.currentPage-1)*this.numPerPage,e=t+this.numPerPage;this.currentPageList=this.filteredList.slice(t,e)},searchKeyword:"",search:function(){this.filteredList=n("filter")(this.data,this.searchKeyword),this.totalItems=this.filteredList.length;var t=(this.currentPage-1)*this.numPerPage,e=t+this.numPerPage;this.currentPageList=this.filteredList.slice(t,e)},numPageChange:function(){var t=(this.currentPage-1)*this.numPerPage,e=t+this.numPerPage;this.currentPageList=this.filteredList.slice(t,e)},init:function(t){this.data=t,this.totalItems=t.length,this.filteredList=t;var e=(this.currentPage-1)*this.numPerPage,i=e+this.numPerPage;this.currentPageList=this.filteredList.slice(e,i)}},e.initData=function(){o.getAllRecords().then(function(t){e.records.init(t.data)}).catch(function(t){console.log(t)})},e.showAttachment=function(t){e.selectedRecord=t,$("#img-attach").modal("show")},e.approve=function(t){e.submit={error:!1,message:null},o.approveRecord(t).then(function(t){e.submit={error:!1,message:"Record approved"},$("#submit-status").modal("show"),r(function(){$("#submit-status").modal("hide")},2e3),e.initData()}).catch(function(t){e.submit={error:!1,message:t.data.message},$("#submit-status").modal("show"),r(function(){$("#submit-status").modal("hide")},2e3)})},e.dissaprove=function(t){o.disapproveRecord(t).then(function(t){e.submit={error:!1,message:"Record disapproved"},$("#submit-status").modal("show"),r(function(){$("#submit-status").modal("hide")},2e3),e.initData()}).catch(function(t){e.submit={error:!1,message:t.data.message},$("#submit-status").modal("show"),r(function(){$("#submit-status").modal("hide")},2e3)})},e.checkUser=function(){if(a.user)e.initData(),e.user=a.getUser(),e.$emit("childEmit",e.user);else{var t=s.get("run_proud_token");t?a.getClaimsFromToken(t,function(t){e.user=t.data.principal.user,e.$emit("childEmit",e.user),e.initData()},function(t){console.log(t),a.clearData(),s.remove("run_proud_token"),i.go("login")}):i.go("login")}},e.checkUser(),e.logout=function(){s.remove("run_proud_token"),a.logout(),i.go("login")}}]);