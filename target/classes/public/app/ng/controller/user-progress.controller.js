angular.module("run_proud").controller("UserProgressController",["$scope","$state","$stateParams","$cookies","RunEventDataOp","Access",function(s,t,e,r,n,i){s.runEventReg=null,s.userProgress=null,s.submitions={data:[],currentPageList:[],filteredList:[],totalItems:0,numPages:void 0,maxSize:5,currentPage:1,boundary_links:!0,numPerPage:10,numPerPageSelections:[5,10,20,50,100],pageChange:function(){var e=(this.currentPage-1)*this.numPerPage,t=e+this.numPerPage;this.currentPageList=this.filteredList.slice(e,t)},searchKeyword:"",searchDB:function(){this.filteredList=$filter("filter")(this.data,this.searchKeyword),this.totalItems=this.filteredList.length;var e=(this.currentPage-1)*this.numPerPage,t=e+this.numPerPage;this.currentPageList=this.filteredList.slice(e,t)},numPageChange:function(){var e=(this.currentPage-1)*this.numPerPage,t=e+this.numPerPage;this.currentPageList=this.filteredList.slice(e,t)},init:function(e){this.data=e,this.totalItems=e.length,this.filteredList=e;var t=(this.currentPage-1)*this.numPerPage,s=t+this.numPerPage;this.currentPageList=this.filteredList.slice(t,s)}},s.userProgress={},s.getUserProgressById=function(e,t){n.getUserProgressByid(e,t).then(function(e){0<Object.getOwnPropertyNames(e.data).length&&(s.userProgress=e.data,distance=e.data.distanceTraveled,totalDistance=e.data.eventCategory.distance,percent=distance/totalDistance*100,s.userProgress.percent=percent)}).catch(function(e){console.log(e)})},s.getRunRecordsByEventByUser=function(e,t){n.getRunRecordsByEventByUser(e,t).then(function(e){s.submitions.init(e.data)}).catch(function(e){console.log(e)})},s.initData=function(){e.eventId&&0<e.eventId&&e.userId&&0<e.userId?(s.getUserProgressById(e.eventId,e.userId),s.getRunRecordsByEventByUser(e.eventId,e.userId)):t.go("home")},s.showAttachment=function(e){s.selectedRun=e,console.log(s.selectedRun),$("#img-attach").modal("show")},s.checkUser=function(){if(i.user)s.initData(),s.user=i.getUser(),s.$emit("childEmit",s.user);else{var e=r.get("run_proud_token");e?i.getClaimsFromToken(e,function(e){s.user=e.data.principal.user,s.$emit("childEmit",s.user),s.initData()},function(e){console.log(e),i.clearData(),r.remove("run_proud_token"),t.go("login")}):t.go("login")}},s.checkUser()}]);