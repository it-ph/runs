angular.module("run_proud").controller("EventController",["$rootScope","$scope","$state","$cookies","$timeout","$filter","Access","RunEventDataOp",function(t,i,n,r,e,s,a,u){i.user=null,i.events={data:[],currentPageList:[],filteredList:[],totalItems:0,numPages:5,maxSize:5,currentPage:1,boundary_links:!0,numPerPage:10,numPerPageSelections:[5,10,20,50,100],pageChange:function(){var t=(this.currentPage-1)*this.numPerPage,e=t+this.numPerPage;this.currentPageList=this.filteredList.slice(t,e)},searchKeyword:"",search:function(){this.filteredList=s("filter")(this.data,this.searchKeyword),this.totalItems=this.filteredList.length;var t=(this.currentPage-1)*this.numPerPage,e=t+this.numPerPage;this.currentPageList=this.filteredList.slice(t,e)},numPageChange:function(){var t=(this.currentPage-1)*this.numPerPage,e=t+this.numPerPage;this.currentPageList=this.filteredList.slice(t,e)},init:function(t){this.data=t,this.totalItems=t.length,this.filteredList=t,this.filteredList=s("filter")(this.data,this.searchKeyword);var e=(this.currentPage-1)*this.numPerPage,i=e+this.numPerPage;this.currentPageList=this.filteredList.slice(e,i)}},i.viewParticipants=function(t){n.go("event_participants",{eventId:t.id})},i.getRunEvents=function(){u.getRunEvents().then(function(t){i.events.init(t.data)}).catch(function(t){console.log(t)})},i.isAdmin=function(){return!!i.user&&"ADMIN"==i.user.role},i.start=function(){i.$emit("childEmit",i.user),i.getRunEvents()},i.checkUser=function(t){if(a.user)i.user=a.user,i.start();else{var e=r.get("run_proud_token");e?a.getClaimsFromToken(e,function(t){i.user=t.data.principal.user,i.start()},function(t){console.log(t),a.clearData(),r.remove("run_proud_token"),n.go("login")}):n.go("login")}},i.checkUser(i.start)}]);